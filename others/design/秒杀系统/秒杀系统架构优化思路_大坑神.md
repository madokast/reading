# 秒杀系统架构优化思路

## 文章信息

- 作者：大坑神 https://yq.aliyun.com/users/ufyqtqscoxg2y 
- 地址：https://yq.aliyun.com/articles/69704 

## 系统难点——库存

库存只有一份，所有人会在集中的时间读和写这些数据

## 优化思路

- 尽量将请求拦截在系统上游
- 读多写少的常用多使用缓存
- 因为服务器直到商品数量，所以没必要放十万、百万请求到DB。排队+一批批的放行。

## 具体优化措施

- 浏览器层请求拦截

`按钮置灰，禁止用户重复提交请求。拦截80%流量。`

- 站点层请求拦截与页面缓存

`做页面缓存，同一个uid、同一个item的查询，一段时间内返回同一结果。拦截99%流量`

- 服务层请求拦截与数据缓存

`核心：我是服务层，我清楚的知道小米只有1万部手机，我清楚的知道一列火车只有2000张车票，我透10w个请求去数据库有什么意义呢？`

`方案：对于写请求，做请求队列，每次只透有限的写请求去数据层，如果均成功再放下一批，如果库存不够则队列里的写请求全部返回“已售完”，读请求使用 cache 杠。`

- 数据层闲庭信步

`到了数据这一层，几乎就没有什么请求了，单机也能扛得住，透这么多请求来数据库没有意义。`
